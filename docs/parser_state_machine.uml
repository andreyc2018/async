@startuml

[*] --> StartingBlock
StartingBlock : expecting "{" or "cmd"
StartingBlock --> ExpectingDynamicCommands : "{"
StartingBlock --> ExpectingStaticCommands : "cmd"
ExpectingDynamicCommands --> StartingBlock : "}"
ExpectingDynamicCommands --> CollectingDynamicBlock : "cmd"
CollectingDynamicBlock --> CollectingDynamicBlock : "cmd"
CollectingDynamicBlock --> DoneBlock : "}"

ExpectingStaticCommands --> CollectingStaticBlock : "cmd"
CollectingStaticBlock --> CollectingStaticBlock : "cmd"
CollectingStaticBlock --> DoneBlock : block_is_full ||\n"{" ||\nend_of_stream

DoneBlock : notifes processor about command block
DoneBlock --> StartingBlock

@enduml